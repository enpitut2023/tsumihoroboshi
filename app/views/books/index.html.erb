<h2>Books</h2>
<table class='table table-hover table-inverse'>
    <thead>
        <tr>
            <th></th>
            <th>Title</th>
            <th>Opinion</th>
            <th colspan="4"></th>
        </tr>
    </thead>
    <tbody>
        <% @book_all.each do |book| %>
            <tr>
                <td>
                    <% if book.image_url.present? %>
                        <%= image_tag book.image_url, format: "jpeg", fallback: "no_image.jpg", size:"50x75" %>
                    <% elsif book.image.attached? %>
                        <%= image_tag book.image, format: "jpeg", fallback: "no_image.jpg", size:"50x75" %>
                    <% end %>
                </td>
                <td><%= book.title %></td>
                <td><%= book.body %></td>
                <!-- <td><%= link_to "編集", edit_book_path(book.id) %></td>
                <td><%= link_to "削除", book_path(book.id), method: :delete, data: { confirm: '本当に削除しますか？' } %></td> -->
                <td><%= link_to "詳細", book_path(book.id), method: :get %></td>
                <% if current_user.present? %>
                    <td><%= link_to "積み本登録", book_tsundokus_path(book.id), method: :post %></td>
                <% end %>
                    <% if current_user.present? %>
                        <% if current_user.like?(book) %>
                            <td><%= form_with(model: current_user.likes.find_by(book_id: book.id), local: true, method: :delete) do |f| %>
                                <%= hidden_field_tag :book_id, book.id %>
                                <%= f.submit '登録解除', class: 'btn btn-danger' %></td>
                        <% end %>
                        <% else %>
                            <td><%= form_with(model: current_user.likes.build, local: true) do |f| %>
                                <%= hidden_field_tag :book_id, book.id %>
                                <%= f.submit 'お気に入り登録', class: 'btn btn-primary' %></td>
                        <% end %>
                    <% end %>
                <% end %>
            </tr>
        <% end %>
    </tbody>
</table>

<p><%= link_to "自分で本を登録", new_book_path %></p>
<h2>Google Books APIからの検索</h2>
<div class="search_form">
    <%= form_with url: books_path, local: true, method: :get do |f| %>
        <ul>
        <li>keyword<%= f.text_field :q %></li>
        <li>title<%= f.text_field :t %></li>
        <li>author<%= f.text_field :a %></li>
        <li>ISBN<%= f.text_field :i %>
        <%= f.submit "検索", class: "btn btn-primary" %>
        </li>
    <% end %>
</div>

<% if @book_from_api.present? %>
<table class='table table-hover table-inverse'>
    <thead>
        <tr>
            <th></th>
            <th>Title</th>
            <th>Opinion</th>
            <th colspan="4"></th>
        </tr>
    </thead>
    <tbody>
        <% @book_from_api.each do |book| %>
            <tr>
                <td>
                    <% if book[:image_url].present? %>
                        <%= image_tag book[:image_url], format: "jpeg", fallback: "no_image.jpg", size:"50x75" %>
                    <% end %>
                </td>
                <td><%= book[:title] %></td>
                <td><%= book[:body] %></td>
                <td>
                    <% if current_user.present? %>
                        <%= form_with model:@book_new, local:true do |f| %>
                            <%= f.hidden_field :title, value: book[:title] %>
                            <%= f.hidden_field :body, value: book[:body] %>
                            <%= f.hidden_field :image_url, value: book[:image_url] %>
                            <%= f.hidden_field :isbn, value: book[:isbn] %>
                            <%= f.submit "積み本登録" %>
                        <% end %>
                    <% end %>
                </td>
            </tr>
        <% end %>
    </tbody>
</table>
<% end %>
